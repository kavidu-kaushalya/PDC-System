<Window x:Class="PDC_System.Payroll_Details.LoanHistoryWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:PDC_System.Payroll_Details"
        xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
        mc:Ignorable="d"
         Foreground="{DynamicResource Forground}"
        Title="Loan History" MinHeight="800" Width="900"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource Background}">

    <Grid Margin="15">

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- ===== SUMMARY ===== -->
        <Border Grid.Row="0" 
                Background="{DynamicResource Background}" 
                Padding="12" 
                CornerRadius="6" 
                Margin="0 0 0 15"
                BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1">

            <StackPanel>
                <TextBlock x:Name="SummaryText"
                      FontSize="18"
                       Foreground="{DynamicResource Forground}"
                      FontWeight="Bold"/>

                <TextBlock x:Name="EmployeeNameText"
                       FontSize="18"
 Foreground="{DynamicResource Forground}"
FontWeight="Bold"/>

            </StackPanel>

           
            
            
        </Border>


        <!-- ===== HISTORY TABLE ===== -->
        <Border Grid.Row="2" 
                Background="{DynamicResource Background}" 
                Padding="10" 
                CornerRadius="6"
                Margin="0 0 0 15"
                BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1">

            <StackPanel>
                <TextBlock Text="Loan Payment History"
                           FontSize="16"
                            Foreground="{DynamicResource Forground}"
                           FontWeight="SemiBold"
                          
                           Margin="5"/>

                <Grid>
                    <Button Content="➕ Add Manual Entry"
Width="170"
                Style="{DynamicResource ActionButton}"
Margin="0 10 0 10"
Padding="5"
HorizontalAlignment="Left"
Click="AddManualEntry_Click"/>
                    <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                        <Button Content="📄 Export PDF"
Width="100"
                Style="{DynamicResource ActionButton}"
Margin="0 10 0 10"
Padding="5"
HorizontalAlignment="Left"
Click="ExportPdf_Click"/>


                        <Button Content="✉ Send Email"
Width="100"
                Style="{DynamicResource ActionButton}"
Margin="10,10,0,10"
Padding="5"
HorizontalAlignment="Left"
Click="SendEmail_Click"/>
                    </StackPanel>
                </Grid>

               

               
               
                
                


                <Separator Background="{DynamicResource BorderBrush}" Margin="0 0 0 10"/>

                <DataGrid x:Name="HistoryGrid"
                          BorderBrush="{x:Null}" HeadersVisibility="Column" IsReadOnly="False"
                           Background="Transparent"
                           RowBackground="White"
                           AlternatingRowBackground="#f0f0f0"
                           SnapsToDevicePixels="True"
                           Height="500"
                           AutoGenerateColumns="False"
                           CanUserResizeColumns="False"
                           CellStyle="{StaticResource DataGridCellStyle}"
                           Style="{StaticResource DataGridStyle}"
                           ColumnHeaderStyle="{StaticResource DataGridHeaderStyle}"
                           RowStyle="{StaticResource DataGridRowStyle}">

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Paysheet ID" Binding="{Binding PaysheetId}" ElementStyle="{DynamicResource DataGridColumnsStyle}" Width="120"/>

                        <DataGridTextColumn Header="Month" Binding="{Binding Month}" Width="120"/>

                        <DataGridTextColumn Header="Installment" Binding="{Binding MonthlyInstallment, StringFormat=N2}" ElementStyle="{DynamicResource DataGridColumnsStyle}" Width="120"/>

                        <DataGridTextColumn Header="Paid" Binding="{Binding PaidAmount, StringFormat=N2}" ElementStyle="{DynamicResource DataGridColumnsStyle}" Width="120"/>

                        <DataGridTextColumn Header="Remaining" Binding="{Binding RemainingAmount, StringFormat=N2}" ElementStyle="{DynamicResource DataGridColumnsStyle}" Width="120"/>

                        <DataGridTextColumn Header="Date" Width="160" ElementStyle="{DynamicResource DataGridColumnsStyle}">
                            <DataGridTextColumn.Binding>
                                <Binding Path="Date" StringFormat="yyyy-MM-dd HH:mm"/>
                            </DataGridTextColumn.Binding>
                        </DataGridTextColumn>

                        <DataGridTemplateColumn Header="Delete" Width="80">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="🚫 Delete"
                    Style="{DynamicResource DeleteActionButton}"
                    Padding="3"
                    Click="DeleteManual_Click"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>



                    </DataGrid.Columns>

                </DataGrid>
            </StackPanel>

        </Border>


        <!-- ===== PIE CHART ===== -->
        <Border Grid.Row="1" 
                Background="{DynamicResource Background}" 
                Padding="15" 
                CornerRadius="6"
                 BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1">

            <StackPanel Orientation="Vertical">
                <TextBlock Text="Loan Summary Chart"
                           FontSize="16"
                           FontWeight="SemiBold"
                            Foreground="{DynamicResource Forground}"
                           Margin="0 0 0 10"/>

                <lvc:PieChart x:Name="LoanPieChart"
                              LegendLocation="Right"
                              InnerRadius="60"
                              HoverPushOut="12"
                              Height="230"/>

                <TextBlock x:Name="EndDateTextBox"
         FontSize="16"
         Margin="0 10 0 10"
         
                         Foreground="{DynamicResource Forground}"
                       
        
         Padding="5"/>


                <StackPanel Margin="10">
                    <TextBlock x:Name="LoanStartText" FontSize="14" Margin="0 0 0 5"/>
                    <TextBlock x:Name="LoanEndText" FontSize="14" Margin="0 0 0 5"/>
                    <TextBlock x:Name="TotalMonthsText" FontSize="14" Margin="0 0 0 5"/>
                </StackPanel>


            </StackPanel>

        </Border>

    </Grid>
</Window>
