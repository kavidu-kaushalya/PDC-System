<UserControl x:Class="PDC_System.Paysheets.PaysheetWindow"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:PDC_System.Paysheets"
             xmlns:cal="clr-namespace:ModernCalendarLib;assembly=ModernCalendarLib"
             xmlns:conv="clr-namespace:PDC_System.Paysheets.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">

    <UserControl.Resources>
        <conv:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
    </UserControl.Resources>

    <!-- CHANGE StackPanel to Grid -->
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- CARDS -->
            <RowDefinition Height="Auto"/>
            <!-- FILTER -->
            <RowDefinition Height="*"/>
            <!-- DATAGRID -->
        </Grid.RowDefinitions>

        <!-- FILTER PANEL -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,50,0,10">


            <TextBox  x:Name="SearchBox" Height="35" ToolTip="Search by Name, Employee ID or Paysheet ID" Style="{DynamicResource OutsourceSerchBar}" Width="300"  />



            <!-- MONTH COMBO -->
            <ComboBox Style="{DynamicResource ComboBoxFlatStyle}" x:Name="MonthCombo"
              Width="130"
 
              Margin="5"
              SelectedIndex="0">
                <ComboBoxItem Content="All Months"/>
                <ComboBoxItem Content="January"/>
                <ComboBoxItem Content="February"/>
                <ComboBoxItem Content="March"/>
                <ComboBoxItem Content="April"/>
                <ComboBoxItem Content="May"/>
                <ComboBoxItem Content="June"/>
                <ComboBoxItem Content="July"/>
                <ComboBoxItem Content="August"/>
                <ComboBoxItem Content="September"/>
                <ComboBoxItem Content="October"/>
                <ComboBoxItem Content="November"/>
                <ComboBoxItem Content="December"/>
            </ComboBox>


            <!-- YEAR COMBO -->
            <ComboBox x:Name="YearCombo"
              Width="100"
             Style="{DynamicResource ComboBoxFlatStyle}"
              Margin="5"/>

            <!-- FILTER BUTTON -->
            <Button Content="Filter"
      Style="{DynamicResource ActionButton}"
            Click="Filter_Click"/>

            <!-- RESET BUTTON -->
            <Button Content="Reset"
          Style="{DynamicResource NavigationButtonStyle}"
            Click="Reset_Click" Margin="5,0,0,0"/>

            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Right">
                <Button Style="{DynamicResource ActionButton}"
                Width="150"
                        
                Click="CreatePaysheet_Click"
                Content="➕ Create Paysheet"/>
            </StackPanel>



        </StackPanel>

        <!-- Button -->






        <!-- SALARY SUMMARY CARDS -->
        <Grid Grid.Row="1" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- ONE DAY SALARY -->
            <Border Grid.Column="0"
            Background="{DynamicResource Background}"
            CornerRadius="15"
                    BorderThickness="2"
                    BorderBrush="{DynamicResource BorderBrush}"
            Padding="20"
            Margin="0,0,10,0">

                <StackPanel>
                    <TextBlock Text="DAY SALARY TOTAL"
                       Foreground="#9CA3AF"
                       FontSize="13"/>

                    <StackPanel Orientation="Horizontal">

                        <TextBlock x:Name="OneDaySalaryText"
                           Text="LKR 0.00"
                           Foreground="{DynamicResource Forground}"
                           FontSize="28"
                           FontWeight="Bold"/>

                        <TextBlock x:Name="OneDayChangeText"
                           Text=""
                           Foreground="#35d499"
                           FontSize="14"
                           Margin="10,8,0,0"/>
                    </StackPanel>

                </StackPanel>
            </Border>


            <!-- MONTH SALARY -->
            <Border Grid.Column="1"
            Background="{DynamicResource Background}"
BorderBrush="{DynamicResource BorderBrush}"
                    
                    BorderThickness="2"
                    CornerRadius="15"
            Padding="20"
            Margin="10,0,0,0">

                <StackPanel>

                    <TextBlock Text="SALARY TOTAL"
                       Foreground="#9CA3AF"
                       FontSize="13"/>

                    <StackPanel Orientation="Horizontal">

                        <TextBlock x:Name="MonthSalaryText"
                           Text="LKR 0.00"
                           Foreground="{DynamicResource Forground}"
                           FontSize="28"
                           FontWeight="Bold"/>

                        <TextBlock x:Name="MonthProjectionText"
                           Text=""
                           Foreground="#5b9ced"
                           FontSize="14"
                           Margin="10,8,0,0"/>

                    </StackPanel>

                </StackPanel>
            </Border>

        </Grid>








        <!-- DataGrid -->
        <DataGrid x:Name="PaysheetGrid"
                  Grid.Row="2"
                  AlternatingRowBackground="#f0f0f0"
                  SnapsToDevicePixels="True"
                  AutoGenerateColumns="False"
                  CanUserResizeColumns="False"
                  CellStyle="{StaticResource DataGridCellStyle}"
                  Style="{StaticResource DataGridStyle}"
                  ColumnHeaderStyle="{StaticResource DataGridHeaderStyle}"
                  RowStyle="{StaticResource DataGridRowStyle}">

            <DataGrid.Columns>

                <DataGridTextColumn Header="Employee ID"
                                    Binding="{Binding EmployeeId}"
                                     Width="*"
                                    ElementStyle="{DynamicResource DataGridColumnsStyle}" />

                <DataGridTextColumn Header="Month"
                                    Binding="{Binding Month}"
                                     Width="*"
                                    ElementStyle="{DynamicResource DataGridColumnsStyle}" />

                <DataGridTextColumn Header="Paysheet ID"
                                    Binding="{Binding PaysheetId}"
                                     Width="*"
                                    Foreground="#5b9ced"
                                    ElementStyle="{DynamicResource DataGridColumnsStyle}" />

                <DataGridTextColumn Header="Name"
                                    Binding="{Binding EmployeeName}"
                                     Width="*"
                                    ElementStyle="{DynamicResource DataGridColumnsStyle}"/>

               
                <DataGridTextColumn Header="Earnings"
                                     Width="*"
                                    Foreground="#35d499"
                                    Binding="{Binding TotalEarnings, StringFormat=LKR {0:N2}}"
                                    ElementStyle="{DynamicResource DataGridColumnsStyle}" />

                <DataGridTextColumn Header="Deductions"
                                     Width="*"
                                    Foreground="#FFE84E4E"
                                   Binding="{Binding TotalDeductions, StringFormat=LKR {0:N2}}"
                                    ElementStyle="{DynamicResource DataGridColumnsStyle}" />

                <DataGridTextColumn Header="Salary"
                        Binding="{Binding Salary, StringFormat=LKR {0:N2}}"
                      Width="*"
                                    FontWeight="Bold"
                     ElementStyle="{DynamicResource DataGridColumnsStyle}"/>


                <DataGridTemplateColumn Header="Actions"  Width="300">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">

                                <Button Style="{DynamicResource EditActionButton}"
                                        Content="Edit"
                                        Click="EditPaysheet_Click"
                                        Tag="{Binding}"
                                        Margin="2"/>

                              
                                <Button Content="View"
                                        Style="{DynamicResource ViewActionButton}"
                                        Tag="{Binding PDFPath}"
                                        Click="OpenPDF_Click"
                                        
                                        Margin="5,2,5,2"
                                        
                                        Visibility="{Binding PDFPath, Converter={StaticResource StringToVisibilityConverter}}"/>

                                <Button Style="{DynamicResource DeleteActionButton}"
          Content="🚫 Delete"
          Click="DeletePaysheet_Click"
          Tag="{Binding}"
          />


                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

            </DataGrid.Columns>

        </DataGrid>

    </Grid>

</UserControl>